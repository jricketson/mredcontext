fs = require('fs')
path = require('path')
mime = require('mime')
file = require('models/file')

class Folder
  constructor: (@path) ->
    @files = []

  read: ->
    fs.readdir(@path, (error, files) =>
      if (error)
        console.error(error)
        @_readDeferred.reject(error)
        return

      for f in files
        if f[0] != '.' #if it is hidden
          full_path = path.join(@path, f)
          file_type = mime.stat(full_path)
          if file_type == 'folder'
            @files.push new Folder(full_path)
          else
            @files.push new file.File(full_path, file_type)
      @_readDeferred.resolve()
    )
    @_readDeferred = new $.Deferred()

module.exports.Folder = Folder