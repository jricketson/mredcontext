fs = require('fs')

class File extends Backbone.Model

  rootPath: ''

  initialize: ->
    @set(content: '', dirty: false)
    @on('change:content', => console.trace(); @set(dirty: true))

  projectPath: ->
    @get('path').substr(File.rootPath.length)

  readContentsFromDisk: ->
    readPromise = new $.Deferred()
    fs.readFile(@get('path'), 'utf8', (err, data) => 
      throw err if err
      @set({content: data, dirty: false}, {silent: true})
      @trigger('reloaded')
    )
    readPromise

  writeContentsToDisk: ->
    writePromise = new $.Deferred()
    fs.writeFile(@get('path'), @get('content'), 'utf8', (err) =>
      throw err if err
      @set(dirty: false)
      writePromise.resolve()
    )
    writePromise

  isDirty: ->
    @get('dirty')

  toString: ->
    "<File>:#{@projectPath()}"

module.exports.File = File