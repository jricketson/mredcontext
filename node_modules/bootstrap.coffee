FileList = require('models/file_list')
FileFinder = require('views/file_finder_view')
EditorPane = require('views/editor_pane_view')
UnsavedFileList = require('views/unsaved_file_list_view')
UnsavedFileCollection = require('models/unsaved_file_collection')

setupShortcuts= (fileFinder) ->
  $(document).bind('keydown', 'ctrl+p', -> fileFinder.show())

exports.bootstrap = ->
  console.log("Starting in '#{process.cwd()}'")
  fileList = new FileList.FileList(null, path: process.cwd() + "/")
  fileList.startRead().done ->
    console.log("finished reading files")

  fileFinder = new FileFinder.FileFinderView(model:fileList)
  $("body").append fileFinder.render().el

  editorPane = new EditorPane.EditorPaneView(el:$('#editorPane'))
  fileFinder.on('fileSelected', (file) -> editorPane.loadFile(file))

  unsavedFileCollection = new UnsavedFileCollection.UnsavedFileCollection(null, collection:fileList)
  unsavedFileList = new UnsavedFileList.UnsavedFileListView(model:unsavedFileCollection)
  $("body").append unsavedFileList.render().el

  setupShortcuts(fileFinder)
